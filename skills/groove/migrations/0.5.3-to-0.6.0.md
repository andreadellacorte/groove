# Migration: 0.5.3 → 0.6.0

## Outcome

`.groove/index.md` uses per-component `git.*` sub-keys instead of a flat `git:` value. The obsolete `finder:` and `sessions:` keys are removed. `.groove/.gitignore` is regenerated to match. `.beans.yml` task path points to `.groove/tasks/`.

## Acceptance Criteria

- `git:` in `.groove/index.md` is a mapping with `memory:`, `tasks:`, and `hooks:` sub-keys
- `finder:` key is absent from `.groove/index.md`
- `sessions:` key is absent from `.groove/index.md` (may already be gone from 0.4.0→0.5.0)
- `.groove/.gitignore` reflects the new per-component strategies
- `.beans.yml` has `path: .groove/tasks` (if beans is configured)
- `.groove/tasks/` directory exists (if beans is configured)
- No other keys in `.groove/index.md` are modified

## Constraints

- This migration is idempotent — safe to re-run if interrupted

### Step 1 — Migrate flat `git:` to sub-keys

Read `git:` from `.groove/index.md` frontmatter.

- If `git:` is already a mapping (has sub-keys `memory:`, `tasks:`, `hooks:`): skip this step
- If `git:` is a flat string value (e.g. `ignore-all`), replace it with:
  ```yaml
  git:
    memory: <old-value>
    tasks: <old-value>
    hooks: <old-value>
  ```

### Step 2 — Regenerate `.groove/.gitignore`

Delete `.groove/.gitignore` if it exists. Regenerate from the new `git.*` sub-keys:

| Component | Strategy | Entry |
|---|---|---|
| `git.memory` | `ignore-all` | `memory/` |
| `git.memory` | `hybrid` | `memory/sessions/` |
| `git.memory` | `commit-all` | _(none)_ |
| `git.tasks` | `ignore-all` | `tasks/` |
| `git.tasks` | `commit-all` | _(none)_ |
| `git.hooks` | `ignore-all` | `hooks/` |
| `git.hooks` | `commit-all` | _(none)_ |

If no entries are generated, write: `# groove git strategy: commit-all`

### Step 3 — Remove obsolete config keys

If `finder:` key is present in `.groove/index.md` frontmatter, remove it. If absent, skip.

If `sessions:` key is present, remove it. If absent, skip.

### Step 4 — Update `.beans.yml` task path

If `tasks: beans` in `.groove/index.md`:
- Check if `.beans.yml` exists at git root
- If it exists and does not already contain `path: .groove/tasks`: update the `path:` value under `beans:` to `.groove/tasks`
- Create `.groove/tasks/` directory if it does not exist
- If `.beans/` exists at git root and `.groove/tasks/` is empty: offer to move task files from `.beans/` to `.groove/tasks/`
